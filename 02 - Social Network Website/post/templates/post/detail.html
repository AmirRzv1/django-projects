{% extends "base.html" %}

{% block content %}
  {% if post.user.id == request.user.id %}
    <a href="{% url 'post:post_delete' post.id %}" class="btn btn-danger"> Delete </a>
    <a href="{% url 'post:post_update' post.id %}" class="btn btn-primary"> Update </a>
  {% endif %}
  {# in date miad va nahve namayesh tarikh ro avaz mikone ke ba horof mizarimesh#}
  <p>
    <a href="{% url 'account:user_profile' post.user.id %}"> {{ post.user.username }} </a>
    | {{ post.updated|date:"Y-M" }}
  </p>
  <p> {{ post.body }} </p>


  <hr/>
    <p> Total comments = {{ comments.count }} </p>
  <hr/>

  {% if request.user.is_authenticated %}
    <a class="{% if can_like %}disabled{% endif %} btn btn-primary col-md-2" href="{% url 'post:post_like' post.id %}">Like {{ post.like_count }}</a>
    <form method="post">
      {% csrf_token %}
      {{ form.as_p }}
      <input type="submit" value="Send Comment !">
    </form>
  <br />
  {% else %}
    <p class="alert alert-danger"> Only logged in users can send comment</p>
  {% endif %}

  {% for comment in comments %}
    <div class="card bg-dark text-white">
      {# this timesince is a filter which tell us how much time passed #}
      <p class="card-header"> {{ comment.user }} | {{ comment.created|timesince }} </p>
      <p class="card-body"> {{ comment.body }} </p>

      {% if request.user.is_authenticated %}
        <form method="post" action="{% url 'post:add_reply' post.id comment.id%}">
          {% csrf_token %}
          {{ form.as_p }}
          <input type="submit" value="Send">
        </form>
      {% endif%}

      {# this with will move the command to a variable name and we use the variable for simplicity#}
      {% with replies=comment.rcomments.all %}

      {% for reply in replies %}
        <p class="bg-primary p-3 m-2"> {{ reply.user }} <br /> {{ reply.body }} </p>
      {% endfor %}
      {% endwith %}
    </div>
    <br />
  {# this empty only runs when there is nothing in out for loop we use it for no comments#}
  {% empty %}
    <p> No Comments yet ! </p>
  {% endfor %}


{% endblock %}